<?php 
  function legal_username($name) {
      $strLength = strlen($name);
      $lengthOk = $strLength >= 6 and $strLength <= 16;
      $formatOk = preg_match("/^[a-zA-Z-_0-9]+$/", $name);
      
      return $lengthOk and $formatOk;
  }
  
  if(legal_username($_POST['un'])) {
    setcookie("user", $_POST['un'], mktime().time() + 7200);  
  } else {
    echo('<script> window.location.href = "index.php"; </script>'); 
    
    if (isset($_SERVER['HTTP_COOKIE'])) {
        $cookies = explode(';', $_SERVER['HTTP_COOKIE']);    
        foreach($cookies as $cookie) {
            $parts = explode('=', $cookie);
            $name = trim($parts[0]);
            setcookie($name, '', time()-1000);
            setcookie($name, '', time()-1000, '/');
        }
    }
  }
?>

<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8" />

  <title>IN618 XSS example</title>

  <link rel="stylesheet" href="css/styles.css?v=1.0" />

</head>

<body>
  <p><img src="picard.jpg" /></p>
  <form action="pg2.php" method="post">
  <p>
    Enter a caption for this picture: <input type="text" name="secure" />
    <input type="submit" value="Enter"/>
  </p>
  </form>
</body>
</html>
